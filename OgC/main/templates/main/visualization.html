{% load static %}
<!DOCTYPE html>

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Include Plotly.js for graph -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style type="text/css">
      /* Hyperlinks at top */
      .hyperlinks {
        float: right; 
        margin-top: 18px;     
      }
      /* Headings at top */     
      ul#headings a {
        display: inline; 
        margin-right: 20px;
        color: #5FB2FF;
      }
      /* Break Lines */
      hr {
        width: 100%;
        height: 3px;
        margin-left: auto;
        margin-right: auto;
        margin-top: -20px;
        background-color: #151515;
        border: 0 none;
      }
      #stock {
         text-align:center; 
         display:inline;
      }
      /* Top Row of Table */
      th {
        background-color: #0072DC;
        color:white;
      }
      /* All Rows in the Table */
      th, td {
        text-align: center;
        border: 1px solid black;
        padding: 15px;
      }
      /* All but top row of table */
      td {
        background-color: #202020; /* I don't like this number */
      }
      /* Table */
      #options {
        border: 2px solid black;
        width: 58%;
        height: 500px;
        float: left;
        margin-left: 3%;
        overflow:auto
      }

      /* Less Space between lines of text */
      p.small {
        font-size: 40px;
        line-height: 0.3;
      }
      p.box_titles {
        line-height: 1;
        color: white; 
        font-size: 40px; 
        text-align: center;
      }
      /* Greeks Box */
      #greeks {
        border: 3px solid gray;
        border-radius: 25px;
        background:#0072DC;
        width: 33%;
        height: 500px;
        float: right;
        margin-right: 3%;
        padding: 20px;
      }
      /* Price Graph */
      #price_graph {
        margin-left: 1.5%;
        margin-right: 1.5%;
        padding: 30px;
      }

      /* Stock Info Table */
      #info_table {
          color: white;
          font-size: 30px;
      }

      /* Stock Info Box */
      #stock_info {
        border: 3px solid gray;
        border-radius: 25px;
        background:#0072DC;
        width: 45.5%;
        float: left;
        margin-left: 3%;
        padding: 30px;
      }
      /* Evaulate Opportunities Box */
      #eval_opp {
        border: 3px solid gray;
        border-radius: 25px;
        background:#0072DC;
        width: 45.5%;
        float: right;
        margin-right: 3%;
        padding: 20px;
      }
      .gauge__body {
        width: 100%;
        height: 0;
        padding-bottom: 50%;
        background: #b4c0be;
        position: relative;
        border-top-left-radius: 100% 200%;
        border-top-right-radius: 100% 200%;
        overflow: hidden;
      }
      .gauge__fill {
        position: absolute;
        top: 100%;
        left: 0;
        width: inherit;
        height: 100%;
        background: #5FB2FF;
        transform-origin: center top;
        transform: rotate(0.25turn);
        transition: transform 0.2s ease-out;
      }
      .gauge__cover {
        width: 75%;
        height: 150%;
        background: #ffffff;
        border-radius: 50%;
        position: absolute;
        top: 25%;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding-bottom: 25%;
        box-sizing: border-box;
      }
    </style>
  </head>

  <body style="background-color:#001444; font-family: Montserrat; margin-left: -24px; margin-top: 5px">
    <div class ="header">
      <!-- List of hyperlinks at top of page -->
      <ul id="headings">
        <!-- OgC Logo Button -->
        <a class = "OGC" href='http://127.0.0.1:8000/'>
          <img src="{% static 'images/logo.png' %}" alt="Home" width="140" height="75">
        </a>

        <!--Hyperlinks-->
        <div class="hyperlinks" style="font-size: 25px">
          <a href='http://127.0.0.1:8000/'>Home</a>
          <a href="help">Help</a></li>
          <a href='about_us'>About Us</a>
          <a href="contact">Contact</a>
          <a href="view">Watchlist</a>
          <a href="login">Login</a></span></p>
        </div>
      </ul>
      <!-- Dividing Line --> 
      <hr style="clear:both"/>
    </div>

    <!-- Stock Name --> 
    <div id = "stock">
        <a href='https://{{stock1 |safe}}.com/'> 
          <h1 class="display-4" style="color: #0072DC">
            <img src="//logo.clearbit.com/{{stock1 | safe}}.com" width = 58px>
            <u>{{stock1}} ({{stock1b}})</u>
            <img src="//logo.clearbit.com/{{stock1 | safe}}.com" width = 58px>
          </h1>
        </a>
      <br>
    </div>

    <!-- Options Table --> 
    <div id = "options" style="color:white;">
      {{options | safe}}
    </div>

    <!-- Greeks Table -->
    <div id="greeks">
        <p class="box_titles">The Greeks!</p>
        <table style="width: 100%" id="info_table">
            <tr>
                <td>δ</td>
                <td>{{delta | safe}}</td>
            </tr>
            <tr>
                <td>ρ</td>
                <td>{{rho | safe}}</td>
            </tr>
            <tr>
                <td>θ</td>
                <td>{{theta | safe}}</td>
            </tr>
            <tr>
                <td>ν</td>
                <td>{{vega | safe}}</td>
            </tr>
            <tr>
                <td>γ</td>
                <td>{{gamma | safe}}</td>
            </tr>
        </table>
    </div>

    <br style="clear:both"/><br>

    <!-- Stock Price Chart -->
    <div id="price_graph">
      {% autoescape off %}
      {{ plot_html }}
      {% endautoescape %}
    </div>
    <br>

    <!-- The Stock Info Box -->
    <div id="stock_info">
        <p class="box_titles">Render Key Stock Data.</p>
        <table style="width: 100%" id="info_table">
            <tr>
                <td>Current Price</td>
                <td>{{ price }}</td>
            </tr>
            <tr>
                <td>Day's Range</td>
                <td>{{ day_range }}</td>
            </tr>
            <tr>
                <td>52 Week Range</td>
                <td>{{ 52wk_range }}</td>
            </tr>
            <tr>
                <td>Volume</td>
                <td>{{ volume }}</td>
            </tr>
            <tr>
                <td>EPS</td>
                <td>{{ eps }}</td>
            </tr>
            <tr>
                <td>Market Cap</td>
                <td>{{ market_cap }}</td>
            </tr>
            <tr>
                <td>Industry</td>
                <td>{{ industry }}</td>
            </tr>
        </table>
    </div>

    <!-- Technical Analysis Box -->
    <div id="eval_opp">
      <p class="box_titles">Evaluate Opportunities for {{stock}} </p>
      <p style="color:white; font-size: 15px; text-align:center">Based on these indicators -- RSI, Money Flow Index, Put-Call Ratio</p>
      <p style="color: white; font-size: 15px; text-align:center">RSI value > 70 = overbought, < 30 = oversold <br /> MFI > 80 = overbought, < 20 = oversold <br /> PCR > 1 (more puts than calls), PCR < 1 (more calls than puts)  </p>
      <p style="color: white; font-size: 10px; text-align:center">Info from Investopedia</p>
      <div class="gauge">
        <div class="gauge__body">
          <div class="gauge__fill"></div>
          <div class="gauge__cover"></div>
        </div>
    </div>    

    <script>
      // JavaScript to make judgements about the value of a stock in tech analysis box-->
      const gaugeElement = document.querySelector(".gauge");
      function setGaugeValue(gauge, value) {
          // Making sure it is in range
          if (value < 0 || value > 1) {
              return;
          }
          //hypothetical good value -> <=0.5
          //hypothetical bad value -> >=0.6
          if (value <= 0.5) {
            gauge.querySelector(".gauge__cover").textContent = `${Math.round(value * 100)}% is a good value for this option`;
          } else if (value >= 0.6) {
            gauge.querySelector(".gauge__cover").textContent = `${Math.round(value * 100)}% is a bad value for this option`;
          }

          gauge.querySelector(".gauge__fill").style.transform = `rotate(${value / 2}turn)`;
          //gauge.querySelector(".gauge__cover").textContent = `${Math.round(value * 100)}%`;
      }
      
      setGaugeValue(gaugeElement, 0.9); //instead of setting as a constant number, pull in from backend
    </script>
  </body>
</html>